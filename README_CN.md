# ğŸ§  OpenCode CLI â€” æ™ºèƒ½ç»ˆç«¯ç¼–ç¨‹åŠ©æ‰‹ï¼ˆUbuntu 24.04 + mgrep å®Œæ•´ç‰ˆï¼‰

> **âš ï¸ è­¦å‘Šï¼šè¿™ä¸æ˜¯ä¸€ä¸ªæ™®é€šå·¥å…·ã€‚é”™è¯¯ä½¿ç”¨å¯èƒ½å¯¼è‡´ä»£ç æ³„éœ²ã€è´¹ç”¨å¤±æ§æˆ–ç³»ç»Ÿä¸ç¨³å®šã€‚è¯·åŠ¡å¿…é˜…è¯»ä»¥ä¸‹æŒ‡å—ï¼**

---

## ğŸ”’ é‡è¦å®‰å…¨ä¸ä½¿ç”¨é¡»çŸ¥

### â— 1. **ä¸è¦åœ¨ç”Ÿäº§ç¯å¢ƒæˆ–æ•æ„Ÿé¡¹ç›®ä¸­ç›´æ¥è¿è¡Œ**
- OpenCode ä¼š**è¯»å–ä½ å½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶**ï¼ˆç”¨äºä¸Šä¸‹æ–‡ç†è§£ï¼‰ã€‚
- å¦‚æœä½ åœ¨åŒ…å«å¯†é’¥ã€ç§æœ‰ä»£ç æˆ–å®¢æˆ·æ•°æ®çš„ç›®å½•ä¸­è¿è¡Œï¼Œ**è¿™äº›å†…å®¹å¯èƒ½è¢«å‘é€åˆ° LLM æœåŠ¡**ï¼ˆå–å†³äºä½ çš„é…ç½®ï¼‰ã€‚
- âœ… **æ­£ç¡®åšæ³•**ï¼šä»…åœ¨å¹²å‡€çš„ã€éæ•æ„Ÿçš„å¼€å‘ç›®å½•ä¸­ä½¿ç”¨ã€‚

### â— 2. **å¿…é¡»å…ˆå®Œæˆèº«ä»½è®¤è¯**
OpenCode **ä¸ä¼šé»˜è®¤å·¥ä½œ**ã€‚é¦–æ¬¡ä½¿ç”¨å‰ï¼Œå¿…é¡»é…ç½® API å¯†é’¥ï¼š

```bash
# é¦–æ¬¡è¿è¡Œä¼šæç¤ºä½ ç™»å½•
docker run -it --rm \
  -v $HOME/.opencode:/root/.opencode \
  opencode-cli auth login
```

æ”¯æŒçš„æœåŠ¡ï¼š
- **OpenRouter**ï¼ˆæ¨èï¼Œèšåˆå¤šæ¨¡å‹ï¼‰
- **Anthropic** (Claude 3.5 Sonnet / Opus)
- **OpenAI** (GPT-4o / GPT-4 Turbo)
- **Ollama**ï¼ˆæœ¬åœ°æ¨¡å‹ï¼Œæœ€å®‰å…¨ï¼Œé›¶éšç§é£é™©ï¼‰

> ğŸ’¡ **å¼ºçƒˆå»ºè®®ä¼˜å…ˆä½¿ç”¨ Ollama + æœ¬åœ°æ¨¡å‹**ï¼ˆå¦‚ `codellama:34b`, `deepseek-coder:6.7b`ï¼‰ä»¥é¿å…éšç§é£é™©å’Œ API è´¹ç”¨ã€‚

---

## ğŸ³ å¿«é€Ÿå¼€å§‹ï¼ˆDocker æ–¹å¼ï¼‰

### 1. æ„å»ºé•œåƒ
```bash
git clone https://github.com/yourname/opencode-docker.git
cd opencode-docker
docker build -t opencode-cli .
```

### 2. é…ç½®è®¤è¯
```bash
# è¿›å…¥äº¤äº’å¼ç™»å½•æµç¨‹
docker run -it --rm \
  -v $HOME/.opencode:/root/.opencode \
  opencode-cli auth login
```

> é¦–æ¬¡è¿è¡Œå°†å¼•å¯¼ä½ é€‰æ‹© LLM æä¾›å•†å¹¶è¾“å…¥ API å¯†é’¥ã€‚é…ç½®ä¿å­˜åœ¨ `$HOME/.opencode/config.json`ã€‚

### 3. åœ¨é¡¹ç›®ç›®å½•ä¸­è¿è¡Œ
```bash
cd /your/project
docker run -it --rm \
  -v $(pwd):/workspace \
  -v $HOME/.opencode:/root/.opencode \
  -w /workspace \
  opencode-cli
```

> âœ… **å…³é”®**ï¼šé€šè¿‡ `-v $(pwd):/workspace` æŒ‚è½½å½“å‰ç›®å½•ï¼ŒOpenCode æ‰èƒ½â€œçœ‹åˆ°â€ä½ çš„ä»£ç ã€‚

---

## âš™ï¸ å…³äº `mgrep` ä¸Šä¸‹æ–‡å¢å¼º

æœ¬é•œåƒå·²é›†æˆ [`@mixedbread/mgrep`](https://www.npmjs.com/package/@mixedbread/mgrep)ï¼Œç”± [mixedbread.ai](https://mixedbread.ai) æä¾›ï¼Œå®ƒèƒ½ï¼š
- åŸºäº ASTï¼ˆæŠ½è±¡è¯­æ³•æ ‘ï¼‰ç†è§£ä»£ç ç»“æ„
- æ™ºèƒ½æå–ç›¸å…³å‡½æ•°ã€ç±»ã€å˜é‡
- è‡ªåŠ¨è¿‡æ»¤æ— å…³æ–‡ä»¶ï¼ˆå¦‚ `node_modules/`, `dist/`ï¼‰
- æ˜¾è‘—å‡å°‘ LLM token æ¶ˆè€—ï¼Œæå‡å“åº”è´¨é‡

å¯åŠ¨æ—¶ä½ ä¼šçœ‹åˆ°ï¼š
```
ğŸ”§ è‡ªåŠ¨å¯ç”¨ mgrep ä½œä¸ºä¸Šä¸‹æ–‡æä¾›å™¨...
```

æ— éœ€é¢å¤–é…ç½®ã€‚å¦‚æœ `mgrep` ä¸å¯ç”¨ï¼ŒOpenCode ä¼šå›é€€åˆ°æ™®é€šæ–‡æœ¬æœç´¢ï¼ˆæ•ˆæœè¾ƒå·®ï¼‰ã€‚

---

## ğŸ“¦ é•œåƒç‰¹æ€§

| ç‰¹æ€§ | è¯´æ˜ |
|------|------|
| **åŸºç¡€ç³»ç»Ÿ** | Ubuntu 24.04 LTSï¼ˆæœ€æ–°ç¨³å®šç‰ˆï¼‰|
| **è¿è¡Œæ—¶** | Bunï¼ˆé«˜æ€§èƒ½ JS/TS è¿è¡Œæ—¶ï¼‰ + Node.js 20ï¼ˆç”¨äº mgrepï¼‰|
| **ä¸Šä¸‹æ–‡å¼•æ“** | `@mixedbread/mgrep`ï¼ˆå…¨å±€å®‰è£…ï¼‰|
| **å…¼å®¹æ€§** | æ”¯æŒ Intel/Apple Silicon Macã€Linux |
| **é•œåƒå¤§å°** | ~320 MBï¼ˆç²¾ç®€æ— å†—ä½™ï¼‰|

---

## ğŸš« å¸¸è§é”™è¯¯ä¸ç¦å¿Œ

| é”™è¯¯è¡Œä¸º | åæœ | æ­£ç¡®åšæ³• |
|--------|------|--------|
| ç›´æ¥ `docker run opencode-cli`ï¼ˆä¸æŒ‚è½½ç›®å½•ï¼‰ | æ— æ³•è®¿é—®ä½ çš„ä»£ç  | å¿…é¡»ç”¨ `-v $(pwd):/workspace` |
| åœ¨ `$HOME`ã€`/` æˆ–å«æ•æ„Ÿæ•°æ®çš„ç›®å½•è¿è¡Œ | å¯èƒ½ä¸Šä¼ æ•´ä¸ªç¡¬ç›˜å†…å®¹ | ä»…åœ¨å…·ä½“é¡¹ç›®ç›®å½•è¿è¡Œ |
| ä½¿ç”¨å…è´¹ API å¯†é’¥é«˜é¢‘è°ƒç”¨ | è¢«å°ç¦æˆ–äº§ç”Ÿé«˜é¢è´¦å• | è®¾ç½®ç”¨é‡ç›‘æ§ï¼Œæˆ–ä½¿ç”¨æœ¬åœ°æ¨¡å‹ |
| å¿½ç•¥ `.opencode/config.json` | æ¯æ¬¡éƒ½è¦é‡æ–°ç™»å½• | ä¿ç•™è¯¥é…ç½®æ–‡ä»¶ï¼Œå¯è·¨æœºå™¨åŒæ­¥ |
| åœ¨å®¹å™¨å†…ä¿®æ”¹ä»£ç ä½†æœªæŒ‚è½½å· | ä¿®æ”¹ä¸¢å¤± | å§‹ç»ˆé€šè¿‡ `-v` æŒ‚è½½å·¥ä½œç›®å½• |

---

## ğŸ”§ æ•…éšœæ’æŸ¥

### Q: å¯åŠ¨åç«‹å³é€€å‡ºï¼Ÿ
A: æ£€æŸ¥æ˜¯å¦å·²é…ç½®è®¤è¯ï¼š
```bash
ls $HOME/.opencode/config.json
```
å¦‚æœæ²¡æœ‰ï¼Œè¯·å…ˆè¿è¡Œ `auth login`ã€‚

### Q: æç¤º â€œmgrep not foundâ€ æˆ–å‘½ä»¤å¤±è´¥ï¼Ÿ
A: ç¡®ä¿æ„å»ºæ—¥å¿—ä¸­åŒ…å«ï¼š
```
npm install -g @mixedbread/mgrep
```
Ubuntu 24.04 éœ€è¦ `build-essential` å’Œ `python3` æ‰èƒ½ç¼–è¯‘åŸç”Ÿæ¨¡å—ã€‚å¦‚ä»å¤±è´¥ï¼Œå°è¯•ï¼š
```bash
docker run --rm opencode-cli which mgrep  # åº”è¿”å› /usr/local/bin/mgrep
```

### Q: åœ¨è€æ¬¾ Macï¼ˆå¦‚ 2012â€“2015ï¼‰ä¸Šæ„å»ºå¤±è´¥ï¼Ÿ
A: ç¡®ä¿ï¼š
- **Colima â‰¥ v0.6.0**ï¼ˆ`brew upgrade colima`ï¼‰
- **ç³»ç»Ÿæ—¶é—´æ­£ç¡®**ï¼ˆmacOS è®¾ç½® â†’ è‡ªåŠ¨è®¾ç½®æ—¥æœŸä¸æ—¶é—´ï¼‰
- **é‡å¯ Colima**ï¼š`colima stop && colima start`

> ğŸ’¡ è‹¥é—®é¢˜æŒç»­ï¼Œå¯ä¸´æ—¶é€€å› `ubuntu:22.04`ï¼ˆä¿®æ”¹ Dockerfile ç¬¬ä¸€è¡Œï¼‰ã€‚

### Q: OpenCode æ— æ³•è°ƒç”¨ mgrepï¼Ÿ
A: æ£€æŸ¥é…ç½®æ–‡ä»¶æ˜¯å¦å¯ç”¨ï¼š
```bash
jq '.contextProvider' $HOME/.opencode/config.json
```
åº”è¿”å› `"mgrep"`ã€‚è‹¥ä¸æ˜¯ï¼Œæ‰‹åŠ¨æ·»åŠ æˆ–åˆ é™¤é…ç½®è®©è„šæœ¬è‡ªåŠ¨ä¿®å¤ã€‚

---

## ğŸ› ï¸ é«˜çº§ç”¨æ³•

### ä½¿ç”¨æœ¬åœ° Ollama æ¨¡å‹ï¼ˆæ¨èï¼‰
1. åœ¨ä¸»æœºå®‰è£… [Ollama](https://ollama.com/)
2. æ‹‰å–æ¨¡å‹ï¼š
   ```bash
   ollama pull codellama:34b-instruct-q6_K
   ```
3. ç™»å½•æ—¶é€‰æ‹© **Ollama** ä½œä¸ºæä¾›å•†ï¼Œå¡«å…¥æ¨¡å‹åï¼ˆå¦‚ `codellama:34b-instruct-q6_K`ï¼‰
4. è¿è¡Œå®¹å™¨æ—¶æš´éœ² Ollama socketï¼š
   ```bash
   docker run -it --rm \
     -v $(pwd):/workspace \
     -v $HOME/.opencode:/root/.opencode \
     -v /var/run/docker.sock:/var/run/docker.sock \  # ä»… Linux
     --network host \  # å…è®¸è®¿é—® localhost:11434
     opencode-cli
   ```

> macOS ç”¨æˆ·ï¼šOllama é»˜è®¤ç›‘å¬ `localhost`ï¼ŒDocker Desktop å¯ç›´æ¥è®¿é—®ã€‚

---

## ğŸ“œ è®¸å¯ä¸å…è´£å£°æ˜

- OpenCode æ˜¯ [OpenCode-AI](https://github.com/OpenCode-AI) çš„å¼€æºé¡¹ç›®ã€‚
- `@mixedbread/mgrep` ç”± [mixedbread.ai](https://mixedbread.ai) æä¾›ã€‚
- **æœ¬é•œåƒä»…ä¸ºæ–¹ä¾¿ä½¿ç”¨è€Œå°è£…ï¼Œä½œè€…ä¸å¯¹ä»»ä½•æ•°æ®æ³„éœ²ã€è´¹ç”¨æŸå¤±æˆ–ä»£ç æŸåè´Ÿè´£ã€‚**
- ä½¿ç”¨å³è¡¨ç¤ºä½ å·²ç†è§£å¹¶æ¥å—ä¸Šè¿°é£é™©ã€‚

---

## ğŸ’¡ æœ€ä½³å®è·µæ€»ç»“

âœ… **åš**ï¼š
- åœ¨å¹²å‡€é¡¹ç›®ç›®å½•ä¸­è¿è¡Œ  
- ä¼˜å…ˆä½¿ç”¨ Ollama æœ¬åœ°æ¨¡å‹  
- å®šæœŸæ£€æŸ¥ `$HOME/.opencode/config.json`  
- ç”¨ `git` ç®¡ç†ä»£ç ï¼Œé¿å…ç›´æ¥ä¿®æ”¹  
- å°† `.opencode/` åŠ å…¥å¤‡ä»½ï¼ˆä½†å‹¿æäº¤åˆ° Gitï¼ï¼‰

âŒ **ä¸åš**ï¼š
- åœ¨å«æ•æ„Ÿæ•°æ®çš„ç›®å½•è¿è¡Œ  
- å…±äº«ä½ çš„ `config.json`ï¼ˆå« API å¯†é’¥ï¼‰  
- ç”¨ root æƒé™è¿è¡Œå®¹å™¨  
- æœŸæœ›å®ƒ 100% æ­£ç¡®ï¼ˆLLM ä¼šå¹»è§‰ï¼ï¼‰  

---

> **è®°ä½ï¼šOpenCode æ˜¯åŠ©æ‰‹ï¼Œä¸æ˜¯æ›¿ä»£è€…ã€‚å§‹ç»ˆå®¡æŸ¥å®ƒç”Ÿæˆçš„ä»£ç ï¼**  

ğŸ“š [OpenCode å®˜æ–¹æ–‡æ¡£](https://github.com/OpenCode-AI/opencode)  
ğŸ”— [mgrep on npm (@mixedbread/mgrep)](https://www.npmjs.com/package/@mixedbread/mgrep)  
ğŸ [æäº¤ Issue](https://github.com/OpenCode-AI/opencode/issues)

---

*æ„å»ºæ—¥æœŸï¼š2025 å¹´ 12 æœˆ | åŸºç¡€é•œåƒï¼šUbuntu 24.04 LTS | OpenCode v1.x | mgrep v1.x*
